FROM debian:buster
  
LABEL \
  author="Dustin Miller" \
  description="miniconda2, Picard, GATK4" \
  maintainer="dustin_miller@byu.edu"

RUN \
# Install dependencies and other useful programs
apt-get update \
  && apt-get install -y --no-install-recommends wget=1.20.1-1.1 \
  python3=3.7.3-1 \
  vim=2:8.1.0875-5 \
  unzip=6.0-23+deb10u1 \
  # Install miniconda2
  && wget --no-check-certificate https://repo.continuum.io/miniconda/Miniconda2-4.7.10-Linux-x86_64.sh \
  && bash Miniconda2-4.7.10-Linux-x86_64.sh -b -p \
  && export PATH="/root/miniconda2/bin:$PATH" \
  && /root/miniconda2/bin/conda init \
  && conda config --append channels bioconda \
  && conda config --append channels anaconda \
  # Install samtools
  && conda install -c bioconda samtools=1.9 \
  # Download Reference Files and Plink
  && wget --no-check-certificate https://files.osf.io/v1/resources/3znuj/providers/osfstorage/5d9ddd0ba7bc73000ce87e38/?zip= -O /references.zip \
  && unzip /references.zip -d /references \
  && rm /references.zip \
  && /root/miniconda2/bin/bgzip -d /references/human_g1k_v37_modified.fasta.gz \
  && /root/miniconda2/bin/bgzip -d /references/hg38ToHg19.over.chain.gz \
  && /root/miniconda2/bin/bgzip -d /references/Homo_sapiens_assembly38.fasta.gz \
  && /root/miniconda2/bin/bgzip -d /references/Homo_sapiens_assembly38.dict.gz \
  && /root/miniconda2/bin/bgzip -d /references/Homo_sapiens_assembly38.fasta.fai.gz \

  # Install Picard
  && conda install -c bioconda picard=2.21.1 \
  # Install GATK4
  && conda install -c bioconda gatk4=4.0.5.1
ENV \
  PATH=${PATH}:/root/miniconda2/bin/
